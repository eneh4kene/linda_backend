version: '3.8'
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: linda
      POSTGRES_PASSWORD: linda
      POSTGRES_DB: linda
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
    ports:
      - "6379:6379"

  backend:
    build: .
    depends_on:
      - postgres
      - redis
    environment:
      DATABASE_URL: "postgresql://linda:linda@postgres:5432/linda"
      REDIS_URL: "redis://redis:6379"
      RETELL_API_KEY: "key_914b278785ee67e8529e1e33a002"
      RETELL_WEBHOOK_SECRET: "key_914b278785ee67e8529e1e33a002"
      RETELL_AGENT_ID: "agent_fd6bf55bdfc0483b34e4e1658c"
      RETELL_PHONE_NUMBER: "+447533056047"
      RETELL_TEST_MODE: "false"
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"
      BLOB_READ_WRITE_TOKEN: "vercel_blob_rw_lv2PPdFMgq3wYuTZ_HPasUsuN3f4VnQcHdda7n55cmrfBqM"
      PORT: "3000"
      NODE_ENV: "development"
      API_BASE_URL: "http://localhost:3000"
    ports:
      - "3000:3000"
    # Uncomment to persist node_modules for dev speed
    # volumes:
    #   - .:/app

volumes:
  postgres_data:
